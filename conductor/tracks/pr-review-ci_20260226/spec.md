# Specification: PR Review CI/CD Integration

**Track ID:** pr-review-ci_20260226
**Type:** Feature
**Created:** 2026-02-26
**Status:** Draft

## Summary

A dedicated `POST /github-pr-review` endpoint that accepts a PR URL, clones the target repo, and spawns a new Claude Code session inside it — leveraging the project's own skills and `CLAUDE.md` to perform the review and post it back via `gh` CLI.

## Context

BAREclaw routes messages into persistent Claude CLI sessions via HTTP and Telegram. This feature adds a purpose-built endpoint for PR reviews, triggered by GitHub Actions. Instead of encoding review logic in BAREclaw, the target project defines its own review standards via `.claude/commands/` skills and `CLAUDE.md`. BAREclaw just orchestrates: clone, cd, and hand off to Claude.

## User Story

As a software engineer, I want to use BAREclaw to review my pull requests so that the code review part of my development process doesn't become a bottleneck.

## Acceptance Criteria

- [ ] `POST /github-pr-review` accepts `{ "pr_url": "..." }` and returns 200 immediately
- [ ] BAREclaw clones the target repo, cd's into it, and spawns a new Claude Code session in that directory
- [ ] Claude Code picks up the project's `CLAUDE.md` and `.claude/commands/` skills
- [ ] Claude Code uses the project's review skill (if defined) or falls back to a default `gh`-based review
- [ ] The review is posted back to the PR via `gh pr review`
- [ ] A repo allowlist controls which repos can receive reviews; requests for unlisted repos return an error
- [ ] If the Claude session fails, a comment is posted on the PR indicating the review failed
- [ ] If a new review is triggered for the same PR while one is in progress, the old one is cancelled and a fresh review starts

## Dependencies

None

## Out of Scope

- Implementing a new communication channel
- Review customization or configuration on BAREclaw's side (that's the project's responsibility via `.claude/commands/`)
- Webhook-based triggers (GitHub Actions initiates the call)

## Technical Notes

- The `/github-pr-review` endpoint does not use BAREclaw's session/channel system for persistence — it spawns a one-shot Claude session scoped to the cloned repo
- Temp directories for cloned repos should be cleaned up after the review completes (success or failure)
- `gh` CLI must be authenticated on the BAREclaw host
- Repo allowlist configured via environment variable or config file

---

_Generated by Conductor. Review and edit as needed._
