# Specification: Pass Plugin Dir to PR Review Sessions

**Track ID:** review-plugin-dir_20260227
**Type:** Feature
**Created:** 2026-02-27
**Status:** Draft

## Summary

Make the `code-review` plugin from `gen-ai-agents` available to Claude sessions spawned for PR review by passing `--plugin-dir`, with conditional cloning only when the target repo doesn't already have the plugin installed.

## Context

BAREclaw's PR review flow clones a target repo and spawns a Claude session with the prompt `Run /code-review:review-pr {PR_NUMBER} --repo {REPO_SLUG}`. This relies on the `code-review` plugin being available in the working directory. If the target repo hasn't installed the plugin, the command isn't found and Claude falls back to a generic English review instead of the structured, three-pass PT-BR review.

## User Story

As a PR author, I want automated reviews to use the code-review plugin so that I get structured, three-pass reviews in PT-BR with Conductor plan compliance checking.

## Acceptance Criteria

- [ ] After cloning the target repo, check if the `code-review` plugin already exists (look for `.claude-plugin/plugin.json` or similar marker)
- [ ] If the plugin is missing, shallow-clone `stone-payments/gen-ai-agents` to a sibling temp directory
- [ ] Pass `--plugin-dir` to the Claude session pointing at the `code-review` plugin directory
- [ ] Session host supports forwarding `pluginDirs` config to the `claude` CLI
- [ ] Existing tests updated, new tests cover plugin detection and conditional cloning
- [ ] Temp plugin repo directory is cleaned up alongside the target repo

## Dependencies

- `stone-payments/gen-ai-agents` must have the `code-review` plugin merged (PR #9 — already merged)
- `review-plugin_20260226` track (already complete — simplified prompt to `/code-review:review-pr`)

## Out of Scope

- Supporting multiple plugin repos (only `gen-ai-agents` for now)
- Caching/persisting the cloned plugin repo across reviews
- Changes to the `code-review` plugin itself
- Plugin marketplace integration in BAREclaw
- Configurable plugin repo URL via env var

## Technical Notes

- Plugin repo is hardcoded: `stone-payments/gen-ai-agents`
- Plugin path within repo: `plugins/code-review`
- Detection: check for existence of a `code-review` command/plugin in the cloned repo (e.g. `.claude/plugins.json` referencing code-review, or `plugins/code-review/.claude-plugin/plugin.json`)
- Claude CLI flag: `--plugin-dir <path>` loads plugins from a directory for that session only
- Cleanup: both temp dirs (target repo + plugin repo) must be removed in the `finally` block

---

_Generated by Conductor. Review and edit as needed._
